---
format: 
  dashboard:
    theme: yeti
---

```{r, loading packages}
#| message: false
#| include: false
library(tidyverse)
library(hrbrthemes)
library(viridis)
Sys.setlocale(locale = 'no_NB.utf8')
```

## Column {.tabset}

```{r, laste data}
# få data inn
# Loading libraries
library(tidyverse)

# loading data
df_desc <- read_rds(here::here("data/kjonn_neet"))

#klargjøre dta for linjediagram
library(dplyr)
library(ggplot2)
library(plotly)
library(scales)   # for label_number

# Velg målgruppa
base <- df_desc %>%
  filter(
    alder == "15-29 år",
    kjonn == "Begge kjønn"
  )

# --- (A) Fylkes-serier: Buskerud, Vestfold, Telemark ---
fylker <- c("Buskerud", "Vestfold", "Telemark")

ts_fylke <- base %>%
  filter(fylkesnavn %in% fylker) %>%
  group_by(tid, fylkesnavn) %>%
  summarise(
    # to likeverdige måter—velg én:

    # 1) Bruk hvis du har neet_andel i prosent allerede:
    neet_pct = weighted.mean(neet_andel, w = tot, na.rm = TRUE),

    # 2) Alternativ: regn fra NEET og tot (sikkert riktig uansett):
    # neet_pct = 100 * sum(NEET, na.rm = TRUE) / sum(tot, na.rm = TRUE),

    .groups = "drop"
  )

ts_norge <- base %>%
  filter(fylkesnavn == "Norge") %>%
  group_by(tid) %>%
  summarise(neet_pct = weighted.mean(neet_andel, w = tot, na.rm = TRUE),
            .groups = "drop") %>%
  mutate(fylkesnavn = "Norge")


#guttesett
# Velg målgruppa
gutter <- df_desc %>%
  filter(
    alder == "15-29 år",
    kjonn == "Menn"
  )

# --- (A) Fylkes-serier: Buskerud, Vestfold, Telemark ---
fylker <- c("Buskerud", "Vestfold", "Telemark")

gutter_fylke <- gutter %>%
  filter(fylkesnavn %in% fylker) %>%
  group_by(tid, fylkesnavn) %>%
  summarise(
    # to likeverdige måter—velg én:

    # 1) Bruk hvis du har neet_andel i prosent allerede:
    neet_pct = weighted.mean(neet_andel, w = tot, na.rm = TRUE),

    # 2) Alternativ: regn fra NEET og tot (sikkert riktig uansett):
    # neet_pct = 100 * sum(NEET, na.rm = TRUE) / sum(tot, na.rm = TRUE),

    .groups = "drop"
  )

gutter_norge <- gutter %>%
  filter(fylkesnavn == "Norge") %>%
  group_by(tid) %>%
  summarise(neet_pct = weighted.mean(neet_andel, w = tot, na.rm = TRUE),
            .groups = "drop") %>%
  mutate(fylkesnavn = "Norge")

#jentesett
# Velg målgruppa
jenter <- df_desc %>%
  filter(
    alder == "15-29 år",
    kjonn == "Kvinner"
  )


jenter_fylke <- jenter %>%
  filter(fylkesnavn %in% fylker) %>%
  group_by(tid, fylkesnavn) %>%
  summarise(
    # to likeverdige måter—velg én:

    # 1) Bruk hvis du har neet_andel i prosent allerede:
    neet_pct = weighted.mean(neet_andel, w = tot, na.rm = TRUE),

    # 2) Alternativ: regn fra NEET og tot (sikkert riktig uansett):
    # neet_pct = 100 * sum(NEET, na.rm = TRUE) / sum(tot, na.rm = TRUE),

    .groups = "drop"
  )

jenter_norge <- jenter %>%
  filter(fylkesnavn == "Norge") %>%
  group_by(tid) %>%
  summarise(neet_pct = weighted.mean(neet_andel, w = tot, na.rm = TRUE),
            .groups = "drop") %>%
  mutate(fylkesnavn = "Norge")

```

```{r}
df_plot <- bind_rows(ts_fylke, ts_norge) %>%
  mutate(fylkesnavn = factor(fylkesnavn, levels = c("Buskerud", "Vestfold", "Telemark", "Norge")))
cols <- c(
  "Buskerud" = "#0072B2",
  "Vestfold" = "#009E73",
  "Telemark" = "#E69F00",  
  "Norge"    = "darkred"   
)
scale_region_colors <- function(name = "Region") {
  scale_color_manual(values = cols, name = name)
}

p3 <- df_plot %>%
  ggplot(aes(x = tid, y = neet_pct, group = fylkesnavn, color = fylkesnavn)) +
  geom_line(size = 1.2) +
  geom_point(size = 1.8) +
  scale_color_viridis_d(end = 0.9, option = "D") +
  labs(
    title = "Prosentandel 15–29 år som er NEET (2013–2023)",
    x = "År", y = "Andel NEET",
    colour = "Region"
  ) +
  scale_y_continuous(labels = label_number(suffix = " %", accuracy = 0.1),
                     breaks = seq(5, 15, by = 1)) +
  coord_cartesian(ylim = c(7.5, 15))+
  theme_classic(base_size = 12) +
  theme(
    axis.text.x  = element_text(size = 12,
                                angle = 45, 
                                hjust = 1),
    axis.text.y  = element_text(size = 12),
    legend.text  = element_text(size = 11),
    legend.title = element_text(size = 12)
    )+  
  scale_region_colors()


```

### Alle

```{r, linje}
# Interaktivt
plotly::ggplotly(
  p3,
  tooltip = c("tid", "neet_pct")
)
```

```{r}
df_gutter <- bind_rows(gutter_fylke, gutter_norge) %>%
  mutate(fylkesnavn = factor(fylkesnavn, levels = c("Buskerud", "Vestfold", "Telemark", "Norge")))

p_gutter <- df_gutter %>%
  ggplot(aes(x = tid, y = neet_pct, group = fylkesnavn, color = fylkesnavn)) +
  geom_line(size = 1.2) +
  geom_point(size = 1.8) +
  scale_color_viridis_d(end = 0.9, option = "D") +
  labs(
    title = "Prosentandel 15–29 år gutter som er NEET (2013–2023)",
    x = "År", y = "Andel NEET",
    colour = "Region"
  ) +
  scale_y_continuous(labels = label_number(suffix = " %", accuracy = 0.1),
                     breaks = seq(5, 15, by = 1)) +
  coord_cartesian(ylim = c(7.5, 15))+
  theme_classic(base_size = 12) +
  theme(
    axis.text.x  = element_text(size = 12,
                                angle = 45, 
                                hjust = 1),
    axis.text.y  = element_text(size = 12),
    legend.text  = element_text(size = 11),
    legend.title = element_text(size = 12)
    )+  
  scale_region_colors()

```

### Gutter

```{r}
plotly::ggplotly(
  p_gutter,
  tooltip = c("tid", "neet_pct")
)
```

```{r}
df_jenter <- bind_rows(jenter_fylke, jenter_norge) |> 
  mutate(fylkesnavn = factor(fylkesnavn, levels = c("Buskerud", "Vestfold", "Telemark", "Norge")))

p_jenter <- df_jenter |> 
  ggplot(aes(x = tid, y = neet_pct, group = fylkesnavn, color = fylkesnavn)) +
  geom_line(size = 1.2) +
  geom_point(size = 1.8) +
  scale_color_viridis_d(end = 0.9, option = "D") +
  labs(
    title = "Prosentandel 15–29 år Jenter som er NEET (2013–2023)",
    x = "År", y = "Andel NEET",
    colour = "Region"
  ) +
  scale_y_continuous(labels = label_number(suffix = " %", accuracy = 0.1),
                     breaks = seq(5, 15, by = 1)) +
  coord_cartesian(ylim = c(7.5, 15))+
  theme_classic(base_size = 12) +
  theme(
    axis.text.x  = element_text(size = 12,
                                angle = 45, 
                                hjust = 1),
    axis.text.y  = element_text(size = 12),
    legend.text  = element_text(size = 11),
    legend.title = element_text(size = 12)
    )+  
  scale_region_colors()


```

### Jenter

```{r}
plotly::ggplotly(
  p_jenter,
  tooltip = c("tid", "neet_pct")
)
```
